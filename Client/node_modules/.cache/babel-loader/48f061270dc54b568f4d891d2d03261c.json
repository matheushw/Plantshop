{"ast":null,"code":"import produce from 'immer';\nimport { mockedUsers } from '../mock-objects/usersList';\nimport { products } from '../mock-objects/products';\nexport const initialState = {\n  loading: {\n    user: false\n  },\n  user: null,\n  products: products,\n  cartProducts: new Map(),\n  usersList: mockedUsers,\n  orders: []\n};\n\nconst reducer = (state = initialState, action) => {\n  switch (action.type) {\n    case \"loadUsersRequest\":\n      return produce(state, draft => {\n        draft.loading.user = true;\n      });\n\n    case \"loadUsersSuccess\":\n      return produce(state, draft => {\n        draft.loading.user = false;\n        draft.user = action.user;\n      });\n\n    case \"loadUsersError\":\n      return produce(state, draft => {\n        draft.loading.user = false;\n      });\n\n    case \"addProductToChart\":\n      return produce(state, draft => {\n        if (state.cartProducts.has(action.product.id)) {\n          const selectedProduct = state.cartProducts.get(action.product.id);\n          draft.cartProducts.set(action.product.id, { ...selectedProduct,\n            quantity: selectedProduct.quantity + 1\n          });\n        } else {\n          draft.cartProducts.set(action.product.id, action.product);\n        }\n      });\n\n    case \"removeProductToChart\":\n      return produce(state, draft => {\n        if (state.cartProducts.has(action.id)) {\n          const selectedProduct = state.cartProducts.get(action.id);\n\n          if (selectedProduct.quantity == 1) {\n            draft.cartProducts.delete(action.id);\n          } else {\n            draft.cartProducts.set(action.id, { ...selectedProduct,\n              quantity: selectedProduct.quantity - 1\n            });\n          }\n        }\n      });\n\n    case \"placeOrder\":\n      return produce(state, draft => {\n        const date = new Date();\n        let totalPrice = 0;\n        let products = new Map();\n        action.products.forEach(product => {\n          totalPrice += parseFloat(product.price);\n\n          if (products.has(product.id)) {\n            const auxProduct = products.get(product.id);\n            products.set(product.id, { ...auxProduct,\n              quantity: auxProduct.quantity + 1\n            });\n          } else {\n            const newProductOrder = {\n              id: product.id,\n              name: product.name,\n              price: product.price,\n              quantity: 1\n            };\n            products.set(product.id, newProductOrder);\n          }\n        });\n        let productsOrders = [];\n        products.forEach(productOrder => productsOrders.push(productOrder));\n        const newOrder = {\n          productsOrders: productsOrders,\n          date: date.getDate() + \"/\" + date.getMonth() + \"/\" + date.getFullYear(),\n          total: totalPrice.toFixed(2),\n          status: \"Preparando para envio!\"\n        };\n        draft.orders = state.orders;\n        draft.orders.push(newOrder);\n      });\n\n    case \"clearCart\":\n      return produce(state, draft => {\n        draft.cartProducts = new Map();\n      });\n\n    case \"logInUser\":\n      return produce(state, draft => {\n        draft.user = action.user;\n      });\n\n    case \"signUpUser\":\n      return produce(state, draft => {\n        const user = {\n          id: state.usersList.length.toString(),\n          email: action.email,\n          password: action.password,\n          name: action.name,\n          address: action.address,\n          phoneNumber: action.phoneNumber,\n          role: 'user'\n        };\n        draft.user = user;\n        draft.usersList.push(draft.user);\n      });\n\n    case \"addInventory\":\n      return produce(state, draft => {\n        draft.products.forEach((product, index) => {\n          if (product.id === action.productId) {\n            draft.products[index].quantity++;\n          }\n        });\n      });\n\n    case \"removeInventory\":\n      return produce(state, draft => {\n        draft.products.forEach((product, index) => {\n          if (product.id === action.productId) {\n            draft.products[index].quantity--;\n          }\n        });\n      });\n\n    case \"removeProduct\":\n      const newProductsArray = [];\n      return produce(state, draft => {\n        draft.products.forEach((product, index) => {\n          if (product.id !== action.productId) {\n            newProductsArray.push(product);\n          }\n        });\n        draft.products = newProductsArray;\n      });\n\n    default:\n      return state;\n  }\n};\n\nexport default reducer;","map":{"version":3,"sources":["/Users/matheuscunha/USP/Plantshop/ps/src/store/reducer.ts"],"names":["produce","mockedUsers","products","initialState","loading","user","cartProducts","Map","usersList","orders","reducer","state","action","type","draft","has","product","id","selectedProduct","get","set","quantity","delete","date","Date","totalPrice","forEach","parseFloat","price","auxProduct","newProductOrder","name","productsOrders","productOrder","push","newOrder","getDate","getMonth","getFullYear","total","toFixed","status","length","toString","email","password","address","phoneNumber","role","index","productId","newProductsArray"],"mappings":"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","sourcesContent":["import produce from 'immer';\nimport { mockedUsers } from '../mock-objects/usersList';\nimport { products } from '../mock-objects/products';\nimport { ApplicationState, ApplicationAction, User, Order, ProductOrder, ProductModel } from './types';\n\nexport const initialState: ApplicationState = {\n  loading: {\n    user: false,\n  },\n  user: null,\n  products: products,\n  cartProducts: new Map(),\n  usersList: mockedUsers,\n  orders: [],\n}\n\nconst reducer = (state = initialState, action: ApplicationAction) => {\n  switch (action.type) {\n    case \"loadUsersRequest\":\n      return produce(state, draft => {\n        draft.loading.user = true;\n      });\n    case \"loadUsersSuccess\":\n      return produce(state, draft => {\n        draft.loading.user = false;\n        draft.user = action.user;\n      });\n    case \"loadUsersError\":\n      return produce(state, draft => {\n        draft.loading.user = false;\n      });\n    case \"addProductToChart\":\n      return produce(state, draft => {\n        if(state.cartProducts.has(action.product.id)){\n          const selectedProduct = state.cartProducts.get(action.product.id)!;\n          draft.cartProducts.set(action.product.id, {...selectedProduct, quantity: selectedProduct.quantity + 1})\n        } else {\n          draft.cartProducts.set(action.product.id, action.product);\n        }\n      });\n    case \"removeProductToChart\":\n      return produce(state, draft => {\n        if(state.cartProducts.has(action.id)){\n          const selectedProduct = state.cartProducts.get(action.id)!;\n          if(selectedProduct.quantity == 1) {\n            draft.cartProducts.delete(action.id);\n          } else {\n            draft.cartProducts.set(action.id, {...selectedProduct, quantity: selectedProduct.quantity - 1})\n          }\n        }\n      });\n    case \"placeOrder\":\n      return produce(state, draft => {\n\n        const date = new Date();\n        let totalPrice: number = 0;\n        let products: Map<string, ProductOrder> = new Map<string, ProductOrder>();\n\n        action.products.forEach((product) => {\n          totalPrice += parseFloat(product.price);\n\n          if (products.has(product.id)){\n            const auxProduct = products.get(product.id)!;\n            products.set(product.id, {...auxProduct, quantity: auxProduct.quantity + 1});\n          } else {\n            const newProductOrder: ProductOrder = {\n              id: product.id, \n              name: product.name, \n              price: product.price, \n              quantity: 1 \n            };\n            products.set(product.id, newProductOrder);\n          }\n\n        });\n\n        let productsOrders: ProductOrder[] = [];\n\n        products.forEach((productOrder) => productsOrders.push(productOrder));\n        \n        const newOrder: Order ={\n          productsOrders: productsOrders,\n          date: date.getDate() + \"/\" + date.getMonth() + \"/\" + date.getFullYear(),\n          total: totalPrice.toFixed(2),\n          status: \"Preparando para envio!\",\n        }\n        draft.orders = state.orders;\n        draft.orders.push(newOrder);\n      });\n    case \"clearCart\":\n      return produce(state, draft => {\n        draft.cartProducts = new Map();\n      });\n    case \"logInUser\":\n      return produce(state, draft => {\n        draft.user = action.user;\n      });\n    case \"signUpUser\":\n      return produce(state, draft => {\n        const user: User = {\n            id: (state.usersList.length).toString(),\n            email: action.email,\n            password: action.password,\n            name: action.name,\n            address: action.address,\n            phoneNumber: action.phoneNumber,\n            role: 'user',\n        }\n        draft.user = user;\n        draft.usersList.push(draft.user); \n      });\n    case \"addInventory\":\n      return produce(state, draft => {\n        draft.products.forEach((product, index) => {\n          if(product.id === action.productId){\n            draft.products[index].quantity++;\n          }\n        })\n      });\n\n    case \"removeInventory\":\n      return produce(state, draft => {\n        draft.products.forEach((product, index) => {\n          if(product.id === action.productId){\n            draft.products[index].quantity--;\n          }\n        })\n      });\n      \n    case \"removeProduct\":\n      const newProductsArray: ProductModel[] = [];\n      return produce(state, draft => {\n        draft.products.forEach((product, index) => {\n          if(product.id !== action.productId){\n            newProductsArray.push(product);\n          }\n        })\n\n        draft.products = newProductsArray;\n      });\n    default:\n      return state;\n  }\n}\n\nexport default reducer;"]},"metadata":{},"sourceType":"module"}