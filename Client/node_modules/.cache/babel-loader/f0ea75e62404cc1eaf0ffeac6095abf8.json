{"ast":null,"code":"import produce from 'immer';\nimport { mockedUsers } from '../mock-objects/usersList';\nimport { products } from '../mock-objects/products';\nexport const initialState = {\n  loading: {\n    user: false\n  },\n  user: null,\n  products: products,\n  cartProducts: new Map(),\n  usersList: mockedUsers,\n  orders: []\n};\n\nconst reducer = (state = initialState, action) => {\n  switch (action.type) {\n    case \"loadUsersRequest\":\n      return produce(state, draft => {\n        draft.loading.user = true;\n      });\n\n    case \"loadUsersSuccess\":\n      return produce(state, draft => {\n        draft.loading.user = false;\n        draft.user = action.user;\n      });\n\n    case \"loadUsersError\":\n      return produce(state, draft => {\n        draft.loading.user = false;\n      });\n\n    case \"addProductToChart\":\n      return produce(state, draft => {\n        draft.cartProducts = state.cartProducts.concat([action.product]);\n      });\n\n    case \"removeProductToChart\":\n      return produce(state, draft => {\n        // draft.cartProducts = state.cartProducts.filter((value) => value.id !== action.id);\n        draft.cartProducts = [];\n        let removed = false;\n        state.cartProducts.forEach(product => {\n          if (!removed && product.id === action.id) {\n            removed = true;\n          } else {\n            draft.cartProducts.push(product);\n          }\n        });\n      });\n\n    case \"placeOrder\":\n      return produce(state, draft => {\n        const date = new Date();\n        let totalPrice = 0;\n        let products = new Map();\n        action.products.forEach(product => {\n          totalPrice += parseFloat(product.price);\n\n          if (products.has(product.id)) {\n            const auxProduct = products.get(product.id);\n            products.set(product.id, { ...auxProduct,\n              quantity: auxProduct.quantity + 1\n            });\n          } else {\n            const newProductOrder = {\n              id: product.id,\n              name: product.name,\n              price: product.price,\n              quantity: 1\n            };\n            products.set(product.id, newProductOrder);\n          }\n        });\n        let productsOrders = [];\n        products.forEach(productOrder => productsOrders.push(productOrder));\n        const newOrder = {\n          productsOrders: productsOrders,\n          date: date.getDate() + \"/\" + date.getMonth() + \"/\" + date.getFullYear(),\n          total: totalPrice.toFixed(2),\n          status: \"Preparando para envio!\"\n        };\n        draft.orders = state.orders;\n        draft.orders.push(newOrder);\n      });\n\n    case \"clearCart\":\n      return produce(state, draft => {\n        draft.cartProducts = [];\n      });\n\n    case \"logInUser\":\n      return produce(state, draft => {\n        draft.user = action.user;\n      });\n\n    case \"signUpUser\":\n      return produce(state, draft => {\n        const user = {\n          id: state.usersList.length.toString(),\n          email: action.email,\n          password: action.password,\n          name: action.name,\n          address: action.address,\n          phoneNumber: action.phoneNumber,\n          role: 'user'\n        };\n        draft.user = user;\n        draft.usersList.push(draft.user);\n      });\n\n    case \"addInventory\":\n      return produce(state, draft => {\n        draft.products.forEach((product, index) => {\n          if (product.id === action.productId) {\n            draft.products[index].quantity++;\n          }\n        });\n      });\n\n    case \"removeInventory\":\n      return produce(state, draft => {\n        draft.products.forEach((product, index) => {\n          if (product.id === action.productId) {\n            draft.products[index].quantity--;\n          }\n        });\n      });\n\n    case \"removeProduct\":\n      const newProductsArray = [];\n      return produce(state, draft => {\n        draft.products.forEach((product, index) => {\n          if (product.id !== action.productId) {\n            newProductsArray.push(product);\n          }\n        });\n        draft.products = newProductsArray;\n      });\n\n    default:\n      return state;\n  }\n};\n\nexport default reducer;","map":{"version":3,"sources":["/Users/matheuscunha/USP/Plantshop/ps/src/store/reducer.ts"],"names":["produce","mockedUsers","products","initialState","loading","user","cartProducts","Map","usersList","orders","reducer","state","action","type","draft","concat","product","removed","forEach","id","push","date","Date","totalPrice","parseFloat","price","has","auxProduct","get","set","quantity","newProductOrder","name","productsOrders","productOrder","newOrder","getDate","getMonth","getFullYear","total","toFixed","status","length","toString","email","password","address","phoneNumber","role","index","productId","newProductsArray"],"mappings":"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","sourcesContent":["import produce from 'immer';\nimport { mockedUsers } from '../mock-objects/usersList';\nimport { products } from '../mock-objects/products';\nimport { ApplicationState, ApplicationAction, User, Order, ProductOrder, ProductModel } from './types';\n\nexport const initialState: ApplicationState = {\n  loading: {\n    user: false,\n  },\n  user: null,\n  products: products,\n  cartProducts: new Map(),\n  usersList: mockedUsers,\n  orders: [],\n}\n\nconst reducer = (state = initialState, action: ApplicationAction) => {\n  switch (action.type) {\n    case \"loadUsersRequest\":\n      return produce(state, draft => {\n        draft.loading.user = true;\n      });\n    case \"loadUsersSuccess\":\n      return produce(state, draft => {\n        draft.loading.user = false;\n        draft.user = action.user;\n      });\n    case \"loadUsersError\":\n      return produce(state, draft => {\n        draft.loading.user = false;\n      });\n    case \"addProductToChart\":\n      return produce(state, draft => {\n        draft.cartProducts = state.cartProducts.concat([action.product]);\n      });\n    case \"removeProductToChart\":\n      return produce(state, draft => {\n        // draft.cartProducts = state.cartProducts.filter((value) => value.id !== action.id);\n        draft.cartProducts = [];\n        let removed: boolean = false;\n        state.cartProducts.forEach((product) => {\n          if(!removed && product.id === action.id){\n            removed = true;\n          } else {\n            draft.cartProducts.push(product);\n          }\n        })\n      });\n    case \"placeOrder\":\n      return produce(state, draft => {\n\n        const date = new Date();\n        let totalPrice: number = 0;\n        let products: Map<string, ProductOrder> = new Map<string, ProductOrder>();\n\n        action.products.forEach((product) => {\n          totalPrice += parseFloat(product.price);\n\n          if (products.has(product.id)){\n            const auxProduct = products.get(product.id)!;\n            products.set(product.id, {...auxProduct, quantity: auxProduct.quantity + 1});\n          } else {\n            const newProductOrder: ProductOrder = {\n              id: product.id, \n              name: product.name, \n              price: product.price, \n              quantity: 1 \n            };\n            products.set(product.id, newProductOrder);\n          }\n\n        });\n\n        let productsOrders: ProductOrder[] = [];\n\n        products.forEach((productOrder) => productsOrders.push(productOrder));\n        \n        const newOrder: Order ={\n          productsOrders: productsOrders,\n          date: date.getDate() + \"/\" + date.getMonth() + \"/\" + date.getFullYear(),\n          total: totalPrice.toFixed(2),\n          status: \"Preparando para envio!\",\n        }\n        draft.orders = state.orders;\n        draft.orders.push(newOrder);\n      });\n    case \"clearCart\":\n      return produce(state, draft => {\n        draft.cartProducts = [];\n      });\n    case \"logInUser\":\n      return produce(state, draft => {\n        draft.user = action.user;\n      });\n    case \"signUpUser\":\n      return produce(state, draft => {\n        const user: User = {\n            id: (state.usersList.length).toString(),\n            email: action.email,\n            password: action.password,\n            name: action.name,\n            address: action.address,\n            phoneNumber: action.phoneNumber,\n            role: 'user',\n        }\n        draft.user = user;\n        draft.usersList.push(draft.user); \n      });\n    case \"addInventory\":\n      return produce(state, draft => {\n        draft.products.forEach((product, index) => {\n          if(product.id === action.productId){\n            draft.products[index].quantity++;\n          }\n        })\n      });\n\n    case \"removeInventory\":\n      return produce(state, draft => {\n        draft.products.forEach((product, index) => {\n          if(product.id === action.productId){\n            draft.products[index].quantity--;\n          }\n        })\n      });\n      \n    case \"removeProduct\":\n      const newProductsArray: ProductModel[] = [];\n      return produce(state, draft => {\n        draft.products.forEach((product, index) => {\n          if(product.id !== action.productId){\n            newProductsArray.push(product);\n          }\n        })\n\n        draft.products = newProductsArray;\n      });\n    default:\n      return state;\n  }\n}\n\nexport default reducer;"]},"metadata":{},"sourceType":"module"}